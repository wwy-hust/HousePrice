# Apache反向代理配置 - 房价数据可视化系统 (仅HTTP版本)
# 适用于将Python web_server.py作为后端服务运行，Apache作为反向代理

<VirtualHost *:80>
    ServerName wenye.wang
    # ServerAlias www.wenye.wang  # 可选的别名
    
    DocumentRoot /Users/wangwenye/Github/HousePrice/web
    
    # 启用代理模块
    ProxyPreserveHost On
    ProxyRequests Off
    
    # 静态文件直接由Apache提供服务（性能更好）
    <Directory "/Users/wangwenye/Github/HousePrice/web">
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        
        # 缓存静态资源
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|woff|woff2|ttf|svg)$">
            ExpiresActive On
            ExpiresDefault "access plus 1 month"
            Header append Cache-Control "public"
        </FilesMatch>
        
        # HTML文件缓存较短时间
        <FilesMatch "\.html$">
            ExpiresActive On
            ExpiresDefault "access plus 1 hour"
        </FilesMatch>
    </Directory>
    
    # API请求代理到Python后端
    ProxyPass /api/ http://127.0.0.1:8000/api/
    ProxyPassReverse /api/ http://127.0.0.1:8000/api/
    
    # 设置代理超时
    ProxyTimeout 300
    
    # 日志配置
    ErrorLog ${APACHE_LOG_DIR}/house-price-error.log
    CustomLog ${APACHE_LOG_DIR}/house-price-access.log combined
    LogLevel info
    
    # 安全头设置
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # 压缩配置
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
</VirtualHost>

# 注意：此配置仅使用HTTP，不包含HTTPS配置
# 如需HTTPS，请参考原始配置文件中的SSL配置部分
